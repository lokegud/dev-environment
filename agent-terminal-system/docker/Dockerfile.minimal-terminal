# Minimal agent terminal container
FROM ubuntu:22.04

# Avoid interactive prompts during build
ENV DEBIAN_FRONTEND=noninteractive

# Install only essential packages
RUN apt-get update && apt-get install -y \
    bash \
    curl \
    vim \
    tmux \
    python3 \
    python3-pip \
    sudo \
    && rm -rf /var/lib/apt/lists/*

# Create agent user
RUN useradd -m -s /bin/bash agent && \
    echo "agent ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers

# Create workspace directory
RUN mkdir -p /home/agent/workspace && \
    chown -R agent:agent /home/agent

# Simple logging wrapper
RUN echo '#!/bin/bash\n\
echo "Agent terminal started for: $AGENT_ID"\n\
echo "Session: $(date)" >> /tmp/agent-${AGENT_ID:-default}.log\n\
exec "$@"' > /usr/local/bin/terminal-wrapper && \
    chmod +x /usr/local/bin/terminal-wrapper

# Switch to agent user
USER agent
WORKDIR /home/agent

# Simple startup
CMD ["tmux", "new-session", "-s", "main", "bash"]